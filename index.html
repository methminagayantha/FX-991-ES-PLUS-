<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casio fx-991ES PLUS (2nd Ed) Simulator</title>
    <style>
        /* --- CSS STYLING --- */
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap');

        body {
            background-color: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Roboto', sans-serif;
            user-select: none; /* Prevent text selection on buttons */
        }

        .calculator {
            background: #1a1a1a; /* Black Body */
            background-image: linear-gradient(145deg, #222, #111);
            width: 380px;
            border-radius: 25px;
            padding: 20px;
            box-shadow: 
                0 20px 50px rgba(0,0,0,0.6),
                inset 0 1px 2px rgba(255,255,255,0.1);
            position: relative;
        }

        /* Branding Area */
        .brand-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            color: #ccc;
            margin-bottom: 10px;
            padding: 0 5px;
        }
        .brand-left h1 { margin: 0; font-size: 18px; color: #fff; letter-spacing: 1px; }
        .brand-left span { font-size: 12px; font-style: italic; color: #aaa; display: block; }
        .brand-right { font-size: 10px; color: #fff; border: 1px solid #555; padding: 2px 4px; border-radius: 3px; background: #000; }

        /* Solar Panel Dummy */
        .solar-panel {
            width: 100px;
            height: 30px;
            background: #4a3b32;
            border: 2px solid #333;
            border-radius: 4px;
            position: absolute;
            top: 20px;
            right: 30px;
            box-shadow: inset 0 0 10px #000;
        }

        /* Screen */
        .screen-frame {
            background: #000;
            padding: 5px;
            border-radius: 8px;
            margin-bottom: 20px;
            margin-top: 40px; /* Space for solar panel */
        }
        .screen {
            background-color: #c4dcc4; /* Classic LCD Green */
            height: 90px;
            border-radius: 4px;
            padding: 5px 10px;
            position: relative;
            font-family: 'Orbitron', monospace;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .screen-indicators {
            display: flex;
            gap: 10px;
            font-size: 10px;
            color: #000;
            height: 15px;
        }
        .screen-main {
            font-size: 20px;
            height: 35px;
            margin-top: 5px;
            white-space: nowrap;
            overflow-x: auto;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        .screen-result {
            font-size: 32px;
            text-align: right;
            margin-top: 5px;
            overflow: hidden;
        }

        /* Keyboard Grid */
        .keyboard {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px 8px; /* Row gap, Col gap */
        }

        /* Labels (Shift/Alpha) */
        .label-container {
            grid-column: span 6;
            display: flex;
            justify-content: space-between;
            padding: 0 10px;
            margin-bottom: -5px;
            font-size: 10px;
            font-weight: bold;
        }
        .lbl-shift { color: #d4b52e; } /* Gold */
        .lbl-alpha { color: #d64a58; } /* Red/Pink */

        /* Button General Styles */
        button {
            border: none;
            outline: none;
            cursor: pointer;
            border-radius: 6px;
            height: 35px;
            font-family: 'Roboto', sans-serif;
            font-size: 12px;
            font-weight: 500;
            position: relative;
            box-shadow: 0 3px 0 #222, 0 4px 5px rgba(0,0,0,0.5);
            transition: transform 0.1s, box-shadow 0.1s;
            color: #fff;
        }
        button:active {
            transform: translateY(3px);
            box-shadow: none;
        }

        /* Tiny labels above buttons */
        .btn-hint {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 9px;
            white-space: nowrap;
            pointer-events: none;
        }
        .hint-shift { color: #d4b52e; }
        .hint-alpha { color: #d64a58; top: -12px; right: -2px; left: auto; transform: none; }

        /* Button Variants */
        .btn-round { border-radius: 50%; width: 35px; height: 25px; margin: 0 auto; background: #555; }
        
        /* Navigation Pad */
        .nav-area {
            grid-column: span 6;
            height: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            margin-bottom: 10px;
        }
        .nav-pad {
            width: 80px;
            height: 70px;
            background: radial-gradient(circle at center, #444, #222);
            border-radius: 50%;
            position: relative;
            box-shadow: 0 5px 10px rgba(0,0,0,0.5);
        }
        .nav-btn {
            position: absolute;
            width: 25px;
            height: 25px;
            background: transparent;
            border: none;
            cursor: pointer;
            box-shadow: none;
        }
        .nav-up { top: 0; left: 27px; }
        .nav-down { bottom: 0; left: 27px; }
        .nav-left { top: 22px; left: 0; }
        .nav-right { top: 22px; right: 0; }
        
        .btn-small-oval {
            background: #666; /* Light grey for top function keys */
            border-radius: 10px;
            height: 25px;
            font-size: 10px;
        }
        
        .btn-black {
            background: #2a2a2a; /* Main function keys */
            border-radius: 5px;
        }
        
        .btn-num {
            background: #3a3a3a; /* Numpad */
            font-size: 18px;
            border-radius: 8px;
        }
        
        .btn-del { background: #6b8c42; color: #fff; } /* The specific Green DEL/AC */
        .btn-ac { background: #6b8c42; color: #fff; } 
        
        /* Spacing Helpers */
        .span-2 { grid-column: span 2; }
    </style>
</head>
<body>

<div class="calculator">
    <div class="brand-header">
        <div class="brand-left">
            <h1>CASIO</h1>
            <span>fx-991ES PLUS</span>
            <span>NATURAL-V.P.A.M.</span>
        </div>
        <div class="brand-right">2nd edition</div>
    </div>
    
    <div class="solar-panel"></div>

    <div class="screen-frame">
        <div class="screen">
            <div class="screen-indicators">
                <span id="ind-shift" style="opacity: 0;">S</span>
                <span id="ind-alpha" style="opacity: 0;">A</span>
                <span id="ind-mode">D</span>
                <span>Math</span>
            </div>
            <div class="screen-main" id="display-main"></div>
            <div class="screen-result" id="display-result">0</div>
        </div>
    </div>

    <div class="keyboard">
        <button class="btn-small-oval" onclick="toggleShift()" style="color:#d4b52e">SHIFT</button>
        <button class="btn-small-oval" onclick="toggleAlpha()" style="color:#d64a58">ALPHA</button>
        
        <div class="span-2 nav-area">
            <div class="nav-pad">
                <button class="nav-btn nav-up" onclick="replay('up')">▲</button>
                <button class="nav-btn nav-down" onclick="replay('down')">▼</button>
                <button class="nav-btn nav-left" onclick="replay('left')">◀</button>
                <button class="nav-btn nav-right" onclick="replay('right')">▶</button>
            </div>
        </div>

        <button class="btn-small-oval" onclick="changeMode()">MODE</button>
        <button class="btn-small-oval" onclick="turnOn()">ON</button>

        <button class="btn-black" onclick="insert('calc')">CALC</button>
        <button class="btn-black" onclick="insert('integral')">∫dx</button>
        <button class="btn-black" onclick="replay('left')">
            ◁<span class="btn-hint hint-shift">REPLAY</span>
        </button>
        <button class="btn-black" onclick="replay('right')">
            ▷
        </button>
        <button class="btn-black" onclick="insertFunction('rec')">x⁻¹</button>
        <button class="btn-black" onclick="insertFunction('log_base')">logₙ</button>

        <button class="btn-black" onclick="insert('/')">a/b</button>
        <button class="btn-black" onclick="insertFunction('sqrt')">√■</button>
        <button class="btn-black" onclick="insertFunction('sq')">x²</button>
        <button class="btn-black" onclick="insertFunction('pow')">xⁿ</button>
        <button class="btn-black" onclick="insertFunction('log')">log</button>
        <button class="btn-black" onclick="insertFunction('ln')">ln</button>

        <button class="btn-black" onclick="insert('-')">(-)</button>
        <button class="btn-black" onclick="insertFunction('deg')">°' "</button>
        <button class="btn-black" onclick="insertFunction('hyp')">hyp</button>
        <button class="btn-black" onclick="insertFunction('sin')">
            sin<span class="btn-hint hint-shift">sin⁻¹</span>
        </button>
        <button class="btn-black" onclick="insertFunction('cos')">
            cos<span class="btn-hint hint-shift">cos⁻¹</span>
        </button>
        <button class="btn-black" onclick="insertFunction('tan')">
            tan<span class="btn-hint hint-shift">tan⁻¹</span>
        </button>

        <button class="btn-black" onclick="insert('rcl')">RCL</button>
        <button class="btn-black" onclick="insert('eng')">ENG</button>
        <button class="btn-black" onclick="insert('(')">(</button>
        <button class="btn-black" onclick="insert(')')">)</button>
        <button class="btn-black" onclick="toggleFormat()">S⇔D</button>
        <button class="btn-black" onclick="insert('m+')">M+</button>

        <button class="btn-num" onclick="insert('7')">7</button>
        <button class="btn-num" onclick="insert('8')">8</button>
        <button class="btn-num" onclick="insert('9')">9</button>
        <button class="btn-del" onclick="backspace()">DEL</button>
        <button class="btn-ac" onclick="allClear()">AC</button>

        <button class="btn-num" onclick="insert('4')">4</button>
        <button class="btn-num" onclick="insert('5')">5</button>
        <button class="btn-num" onclick="insert('6')">6</button>
        <button class="btn-num" onclick="insert('*')">×</button>
        <button class="btn-num" onclick="insert('/')">÷</button>

        <button class="btn-num" onclick="insert('1')">1</button>
        <button class="btn-num" onclick="insert('2')">2</button>
        <button class="btn-num" onclick="insert('3')">3</button>
        <button class="btn-num" onclick="insert('+')">+</button>
        <button class="btn-num" onclick="insert('-')">-</button>

        <button class="btn-num" onclick="insert('0')">0</button>
        <button class="btn-num" onclick="insert('.')">.</button>
        <button class="btn-num" onclick="insertConstant('pi')">×10ˣ<span class="btn-hint hint-shift">π</span></button>
        <button class="btn-num" onclick="insert('Ans')">Ans</button>
        <button class="btn-num" onclick="calculate()">=</button>
    </div>
</div>

<script>
    /* --- JAVASCRIPT LOGIC --- */
    let expr = "";       // Calculation string
    let showExpr = "";   // Display string
    let result = 0;      // Numeric result
    let shift = false;
    let alpha = false;
    let modeDeg = true;  // Degrees vs Radians

    const dMain = document.getElementById('display-main');
    const dRes = document.getElementById('display-result');
    const indShift = document.getElementById('ind-shift');
    const indAlpha = document.getElementById('ind-alpha');
    const indMode = document.getElementById('ind-mode');

    function updateScreen() {
        dMain.innerText = showExpr;
        // Auto scroll to right
        dMain.scrollLeft = dMain.scrollWidth; 
    }

    function toggleShift() {
        shift = !shift;
        indShift.style.opacity = shift ? 1 : 0;
    }
    
    function toggleAlpha() {
        alpha = !alpha;
        indAlpha.style.opacity = alpha ? 1 : 0;
    }

    function changeMode() {
        modeDeg = !modeDeg;
        indMode.innerText = modeDeg ? "D" : "R";
    }

    function turnOn() {
        allClear();
        dRes.innerText = "0";
    }

    function allClear() {
        expr = "";
        showExpr = "";
        result = 0;
        dRes.innerText = "0";
        updateScreen();
    }

    function backspace() {
        expr = expr.slice(0, -1);
        showExpr = showExpr.slice(0, -1);
        updateScreen();
    }

    function insert(val) {
        if(val === 'Ans') {
            expr += result;
            showExpr += "Ans";
        } else {
            expr += val;
            showExpr += val.replace('*', '×').replace('/', '÷');
        }
        updateScreen();
        // Reset modifiers
        if(shift) toggleShift();
        if(alpha) toggleAlpha();
    }

    function insertConstant(c) {
        if(c === 'pi') {
            if(shift) { // Actual Pi
                expr += Math.PI;
                showExpr += "π";
            } else { // x10^x
                expr += "*10**";
                showExpr += "×10^";
            }
        }
        updateScreen();
        if(shift) toggleShift();
    }

    function insertFunction(fn) {
        if(fn === 'sin' || fn === 'cos' || fn === 'tan') {
            if(shift) {
                // Inverse Trig
                expr += `Math.a${fn}(`; 
                showExpr += `${fn}⁻¹(`;
                // Note: handling deg/rad for inverse trig is complex, this is basic impl
            } else {
                // Normal Trig (custom wrapper to handle Deg/Rad)
                expr += `trig('${fn}',`; 
                showExpr += `${fn}(`;
            }
        } 
        else if (fn === 'sqrt') {
            expr += "Math.sqrt(";
            showExpr += "√(";
        }
        else if (fn === 'sq') {
            expr += "**2";
            showExpr += "²";
        }
        else if (fn === 'pow') {
            expr += "**";
            showExpr += "^";
        }
        else if (fn === 'log') {
            expr += "Math.log10(";
            showExpr += "log(";
        }
        else if (fn === 'ln') {
            expr += "Math.log(";
            showExpr += "ln(";
        }
        else if (fn === 'rec') {
            expr += "**-1";
            showExpr += "⁻¹";
        }
        
        updateScreen();
        if(shift) toggleShift();
    }

    // Helper to handle Degrees/Radians for Trig
    function trig(fn, val) {
        if(modeDeg) {
            return Math[fn](val * (Math.PI/180));
        } else {
            return Math[fn](val);
        }
    }

    // Simple Fraction Converter (S<=>D button)
    function toggleFormat() {
        // Basic implementation: tries to find a fraction for the current result
        if (String(result).includes('.')) {
            let len = String(result).length - 2;
            let denominator = Math.pow(10, len);
            let numerator = result * denominator;
            // Simplify (basic)
            let divisor = gcd(numerator, denominator);
            dRes.innerText = (numerator/divisor) + "⌋" + (denominator/divisor);
        } else {
            // Already integer, maybe show as fraction over 1? No, do nothing.
        }
    }

    function gcd(a, b) {
        return b ? gcd(b, a % b) : a;
    }

    function calculate() {
        try {
            // Safe(r) eval
            // We need to close parentheses
            let open = (expr.match(/\(/g) || []).length;
            let close = (expr.match(/\)/g) || []).length;
            let finalExpr = expr + ")".repeat(open - close);

            // Execute in scope where 'trig' is available
            // Note: We use Function constructor to allow 'trig' call
            // We inject 'trig' into window for the eval context or just use local
            // In this simple script, 'trig' is global.
            let res = new Function("return " + finalExpr)();
            
            // Format
            if (String(res).length > 11) {
                res = res.toPrecision(10);
            }
            
            result = parseFloat(res);
            dRes.innerText = result;
            
            // Reset for next calc logic (optional, keeping history in Ans)
            expr = String(result);
            showExpr = String(result);

        } catch (e) {
            dRes.innerText = "Syntax ERROR";
        }
    }
    
    // Navigation placeholder
    function replay(dir) {
        // In a full emulator, this moves cursor. 
        // Here we just flash the screen to show responsiveness.
        dMain.style.opacity = 0.5;
        setTimeout(() => dMain.style.opacity = 1, 100);
    }
</script>

</body>
</html>
